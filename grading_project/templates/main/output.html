<div class="style">
    <style>
    textarea {
        min-height: 40px;
        min-width: 300px;
        width: 100%; /* Растягиваем на всю ширину ячейки */
        resize: none; /* Отключаем возможность изменения размера */
        overflow: hidden; /* Скрываем прокрутку */
    }
    summary {
        white-space: nowrap; /* Оставляем текст в одной строке */
        overflow: hidden; /* Скрываем переполнение */
        text-overflow: ellipsis; /* Добавляем троеточие в конце длинного текста */
        font-weight: bold; /* Можно сделать текст жирным для красоты */
        cursor: pointer; /* Курсор меняется на указатель при наведении */
        font-size: 20px;
    }
    table {
        border-collapse: collapse; /* to make lines visible */
        width: 100%;
    }

    th, td {
        padding: 10px; /* cell spacing */
        text-align: left;
        border: 3px solid black; /* border between columns */
    }

    th {
        background-color: #f2f2f2;
    }

    th a {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }

    th a:hover {
        text-decoration: underline;
    }
    </style>

</div>

<div class="script">
    <script>
        document.addEventListener('input', function (event) {
            if (event.target.tagName.toLowerCase() === 'textarea') {
                autoResizeTextarea(event.target);
            }
        });

        function autoResizeTextarea(textarea) {
            // Сброс высоты, чтобы правильно рассчитать новую высоту
            textarea.style.height = 'auto';
            // Установка высоты равной контенту
            textarea.style.height = textarea.scrollHeight + 'px';
        }

        // Автоматически подгоняем текстовое поле при загрузке страницы
        window.onload = function() {
            document.querySelectorAll('textarea').forEach(function (textarea) {
                autoResizeTextarea(textarea);
            });
        };
    </script>
</div>

<form method="POST" action="{% url 'save-form' %}">
    {% csrf_token %}
    <table border="3">
        <tr>
            <th><a href="?sort_by=name&order={{ current_order }}">Наименование</a></th>
            <th><a href="?sort_by=normative&order={{ current_order }}">Норматив</a></th>
            <th><a href="?sort_by=work_done&order={{ current_order }}">Выполненная работа</a></th>
            <th><a href="?sort_by=points&order={{ current_order }}">Баллы</a></th>

            {% if info.user_role == 'Inspector' %}
            <th><a href="?sort_by=responsible&order={{ current_order }}">Ответственный за ввод данных</a></th>
            <th><a href="?sort_by=faculty&order={{ current_order }}">Факультет</a></th>
            {% endif %}

            <th><a href="?sort_by=status&order_stage={{ current_stage|add:1 }}">Статус</a></th>
        </tr>

        {% if info.user_role == 'Teacher' %}
            {% for table in info.sorted_gradings %}
            <tr>
                <th>{{ table.used_standard }}</th>
                <th>{{ table.used_standard.standard_in_points }}</th>
                <th><textarea
                        name="work_done-!SePaRaToR!-{{ table.user.user.username }}-!SePaRaToR!-{{ table.used_standard }}"
                        placeholder="{{ table.work_done }}"></textarea></th>
                <th><input type="number"
                           name="points-!SePaRaToR!-{{ table.user.user.username }}-!SePaRaToR!-{{ table.used_standard }}"
                           placeholder="{{ table.rating }}"
                           step="0.01"></th>
                <th>{{ table.get_status_display }}</th>
            </tr>
            {% endfor %}
        {% elif info.user_role == 'Inspector' %}
            {% for table in info.sorted_controlled_teachers_gradings %}
            <tr>
                <th>{{ table.used_standard }}</th>
                <th>{{ table.used_standard.standard_in_points }}</th>
                <th><textarea
                           name="work_done-!SePaRaToR!-{{ table.user.user.username }}-!SePaRaToR!-{{ table.used_standard }}"
                           placeholder="{{ table.work_done }}"></textarea></th>
                <th><input type="number"
                           name="points-!SePaRaToR!-{{ table.user.user.username }}-!SePaRaToR!-{{ table.used_standard }}"
                           placeholder="{{ table.rating }}"
                           step="0.01"></th>
                <th>{{ table.user.user.first_name }}  {{ table.user.user.last_name }}</th>
                <th>{% for teacher in info.controlled_users %}
                        {% if teacher.user.profile == table.user %}
                            {{ teacher.faculties|join:", " }}
                        {% endif %}
                    {% endfor %}
                </th>
                <th><select id="status" name="status-!SePaRaToR!-{{ table.user.user.username }}-!SePaRaToR!-{{ table.used_standard }}">
                    {% for value, display in status_choices %}
                        <option value="{{ value }}"
                                {% if value == table.status %} selected {% endif %}>
                            {{ display }}
                        </option>
                    {% endfor %}
                </select></th>
            </tr>
            {% endfor %}
        {% endif %}
        </table>
        <button type="submit">Сохранить</button>
        <br> <br> <br>
</form>
